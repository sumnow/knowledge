# 从按下电源键开始

### 基础

 `boot` 即是引导, 开机引导, 在计算机内存里载入一小段程序, 让计算机可以正常启动。 

### 第一步BIOS

电脑主板上有个CMOS(Complementary Metal Oxide Semiconductor 互补金属氧化物半导体)单元, 一般有纽扣电池来提供电量, 保存了重要的开机数据, 是主板上的可读写RAM芯片。 

BIOS(Basic Input/Output System) , 首先执行硬件自检(Power-On Self-Test), 缩写为POST。 

### 第二步Boot Squence

自检完成之后, BIOS将控制权交给下个程序, Boot Squence(启动顺序), 有限将控制权交给按照启动顺序靠前的设备。 

> 计算机读取第一个设备的第一个扇区, 即最前的512个字节, 如果512个字节的最后两个字符是0x55和0xAA, 表示该设备可以用于启动, 否则, 顺序下一个。 前面这512个字节, 即被称为"主引导记录"(Master boot record)。 

##### 主引导记录

1. 第1-446字节: 调用操作系统的机器码。 
2. 第447-510字节: 分区表(Partition table)。 
3. 第511-512字节: 主引导记录签名(0x55和0xAA)。 

分区表里记录了包括主分区, 逻辑分区等详细信息, 主引导记录签名里, 会有告诉机器, 操作系统在哪一个分区里。 

> 不同系统分区格式不同, 如ext4, ntfs, hfs+等

### MacOS

MAC OS X系统初始化的4个主要阶段依次为: 

1. 固件(Firmware): 在这个阶段初始化Mac硬件, 查找和启动引导程序(Booter)。 这一阶段成功完成后, 发出一声鸣叫(启动声), 电源灯明亮闪烁, 所有显示器显示淡灰色背景。 
2. 引导程序(Booter): 引导程序的主要工作是将系统内核和基本硬件驱动程序, 内核扩展(KEXT), 装入主存, 然后让内核接管系统。 引导程序阶段的标志是在主显示器上显示深灰色的苹果图标。 
3. 内核(Kernel): 内核提供系统的基础, 装载附加的驱动程序和核心BSD UNIX系统。 它的标志是在主显示器的苹果图标下面有一个深灰色的旋转齿轮。 
4. 系统launchd: 当核心操作系统装载后, 它启动第一个进程, 即系统launchd, 该进程负责装载系统的其余部分。 这个阶段的标志是在所有显示器上显示淡蓝色背景。 这个阶段成功完成后, 出现登陆窗口, 如果用户设置为自动登录, 则出现Finder。 

MAC OS X用户环境的3个主要阶段是: 

1. loginwindow: 该进程负责显示登陆屏幕, 并最终使用户登录到系统。 成功完成这一阶段导致用户环境初始化, 因此允许用户的应用程序运行。 
2. 用户launchd: 该进程和loginwindow进程一起工作, 初始化用户环境, 并启动任何用户进程或应用程序。 
3. 用户环境: 这是用户登陆到系统后, 他的进程和应用程序存在的"空间"。 很明显, 用户环境由loginwindow和用户launchd进程维持。 

### UEFI启动流程

UEFI启动流程: 

1. 系统开机 - 上电自检(Power On Self Test 或 POST)。 
2. UEFI 固件被加载, 并由它初始化启动要用的硬件。 
3. 固件读取其引导管理器以确定从何处(比如, 从哪个硬盘及分区)加载哪个 UEFI 应用。 固件按照引导管理器中的启动项目, 加载UEFI 应用。 
4. 已启动的 UEFI 应用还可以启动其他应用(对应于 UEFI shell 或 rEFInd 之类的引导管理器的情况)或者启动内核及initramfs(对应于GRUB之类引导器的情况), 这取决于 UEFI 应用的配置。 

