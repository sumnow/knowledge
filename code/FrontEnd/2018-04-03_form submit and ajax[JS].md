# 表单提交和ajax

今天和同事产生了分歧， 关于浏览器向服务器交互的问题， 我认为只要是满足跨域条件的请求， 都会被浏览器拦截， 导致跨域问题。 关于表单提交会不会， 我没有思索， 就脱口而出， 表单提交也会， 结果自然是打脸， 不然也不会有这个文章了。 

### form 表单提交

form表单提交再平常不过， 如下

```html
    <form action="form_action.asp" method="get" onsubmit="">
        <p>First name: <input type="text" name="fname" /></p>
        <p>Last name: <input type="text" name="lname" /></p>
        <input type="submit" value="Submit" />
    </form>
```

action中设置的url是不受浏览器同源策略影响的。 

### ajax提交

    $.ajax({
        url: '/example', 
        type: 'GET', 
        success: data => console.log(data)
    })

ajax 中 url 受到 浏览器同源策略的约束。 

### 同源策略

浏览器的同源策略会导致跨域， 同源策略又分为以下两种

1. DOM同源策略： 禁止对不同源页面DOM进行操作。 这里主要场景是iframe跨域的情况， 不同域名的iframe是限制互相访问的。 

2. XmlHttpRequest同源策略： 禁止使用XHR对象向不同源的服务器地址发起HTTP请求。 

> 只要协议、 域名、 端口有任何一个不同， 都被当作是不同的域， 之间的请求就是跨域操作。 

本质是， 一个域名的 JS ， 在未经允许的情况下， 不得读取另一个域名的内容。 但浏览器并不阻止你向另一个域名发送请求。 

每一个请求都其实已经发送出去了， 但是无法获得响应罢了。 

### 分析

会不会跨域， 其实主要是依据浏览器的同源策略判断。 

> 浏览器同源策略是出于保障用户的隐私和安全的考虑， 而给js添加的限制。 浏览器本身是可以跨域的， img标签可以饮用任意地址的图片， script可以加载任何域的js。 

form 出现早于ajax异步刷新, 提交后页面会刷新（同步刷新）， 提交了数据之后， 刷新页面， 并不会把返回的数据带给之前的页面， 之前的页面js无法获取数据， 其实也就不存在交互， 因此是一种安全的数据提交方式， 返回的数据会在新的页面中展现。 

ajax 就不同， success可以获 取到服务器返回的数据， 出于安全考虑， 自然需要同源策略的约束。 

anyway， 对于ajax存在的那些问题， form表单根本不会遇到。 浏览器同源策略只是为了限制脚本， 而不是src, action等浏览器默认允许的行为。 

> 为什么只限制脚本的原因很简单， 浏览器默认定义的， 如action等行为不会被改写， 例如用户输入了账号密码， 提交过去也只会是账号密码， 但使用js脚本， 其中的处理， 对用户来说是不可见的。 

> jsonp 的实现方式很巧妙， 虽然js脚本本身无法跨域， 而script标签却可以跨域。 

### 反思

1. 有些自以为是了， 信口开河了。 

2. 考虑问题知道是什么的地步， 没有考虑为什么， 仔细想想， 都可以理解同源策略的本质， 并考虑出form提交的安全性不需要同源策略的约束来保证。 
